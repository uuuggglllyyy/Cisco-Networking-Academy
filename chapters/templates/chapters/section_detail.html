{% extends 'chapters/base.html' %}

{% block title %}{{ section.title }} - Cisco Networking Academy{% endblock %}

{% block content %}
<nav class="breadcrumb">
    <a href="{% url 'module_list' %}">–ú–æ–¥—É–ª–∏</a> ‚Üí
    <a href="{% url 'module_detail' section.chapter.module.id %}">–ú–æ–¥—É–ª—å {{ section.chapter.module.number }}</a> ‚Üí
    <a href="{% url 'chapter_detail' section.chapter.module.id section.chapter.id %}">–ì–ª–∞–≤–∞ {{ section.chapter.number }}</a> ‚Üí
    <span>{{ section.code }}</span>
</nav>

<div class="content">
    <header class="section-header">
        <h1>{{ section.code }} {{ section.title }}</h1>

        <!-- –í–Ω–µ—à–Ω–∏–µ —Å—Å—ã–ª–∫–∏ -->
        {% if section.external_link %}
        <div class="external-links-section">
            <a href="{{ section.external_link }}" target="_blank" class="external-resource-button">
                üåê –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            </a>
            <span class="link-info">–û—Ç–∫—Ä–æ–µ—Ç—Å—è –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ</span>
        </div>
        {% endif %}
    </header>

    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∞ -->
    {% if section.image %}
    <div class="section-image">
        <img src="{{ section.image.url }}" alt="{{ section.title }}" />
        <p class="image-caption">–ò–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è</p>
    </div>
    {% endif %}

    <!-- –ö–æ–Ω—Ç–µ–Ω—Ç —Ä–∞–∑–¥–µ–ª–∞ -->
    <div class="section-content">
        {{ section.content|linebreaks }}
    </div>

    <!-- –ü—Ä–∏–ª–æ–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã -->
    {% if section.attached_file %}
    <div class="attached-files-section">
        <h3>üìé –ú–∞—Ç–µ—Ä–∏–∞–ª—ã –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è:</h3>
        <div class="file-download-card">
            <div class="file-icon">
                {% if section.attached_file.url|lower|slice:'-4:' == '.pdf' %}
                    üìÑ
                {% elif section.attached_file.url|lower|slice:'-4:' == '.doc' or section.attached_file.url|lower|slice:'-5:' == '.docx' %}
                    üìù
                {% elif section.attached_file.url|lower|slice:'-4:' == '.zip' %}
                    üì¶
                {% else %}
                    üìé
                {% endif %}
            </div>
            <div class="file-info">
                <h4>–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –∫ –∑–∞–¥–∞–Ω–∏—é</h4>
                <p>–§–∞–π–ª —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é —Ä–∞–±–æ—Ç—ã</p>
                <div class="file-details">
                    <span class="file-format">
                        {% if section.attached_file.url|lower|slice:'-4:' == '.pdf' %}
                            PDF –¥–æ–∫—É–º–µ–Ω—Ç
                        {% elif section.attached_file.url|lower|slice:'-4:' == '.doc' %}
                            Word –¥–æ–∫—É–º–µ–Ω—Ç
                        {% elif section.attached_file.url|lower|slice:'-5:' == '.docx' %}
                            Word –¥–æ–∫—É–º–µ–Ω—Ç
                        {% elif section.attached_file.url|lower|slice:'-4:' == '.zip' %}
                            ZIP –∞—Ä—Ö–∏–≤
                        {% else %}
                            –§–∞–π–ª
                        {% endif %}
                    </span>
                    <span class="file-size">(~2-3 –ú–ë)</span>
                </div>
            </div>
            <a href="{{ section.attached_file.url }}" download class="download-file-button">
                üì• –°–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª
            </a>
        </div>
    </div>
    {% endif %}

    <!-- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç—Ä–µ–Ω–∞–∂–µ—Ä -->
    {% if section.interactive_data %}
    <div class="interactive-exercise">
        <h2>–£–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ ‚Äî —á–∞—Å—Ç—å 1: –§—É–Ω–∫—Ü–∏–∏ —Å–µ—Ç–µ–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞</h2>
        <p class="exercise-description">–ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é —Å–µ—Ç–µ–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞.</p>

        <div class="exercise-container">
            <!-- –û–±–ª–∞—Å—Ç—å —Å —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –¥–ª—è –ø–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–Ω–∏—è -->
            <div class="functions-area">
                <h3>–§—É–Ω–∫—Ü–∏–∏</h3>
                <div class="functions-list" id="functionsList">
                    <!-- –§—É–Ω–∫—Ü–∏–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                </div>
            </div>

            <!-- –û–±–ª–∞—Å—Ç—å —Å –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏ –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è -->
            <div class="categories-area">
                <h3>–ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h3>
                <div class="categories-list">
                    <div class="category" data-category="end_devices">
                        <h4>–û–∫–æ–Ω–µ—á–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h4>
                        <div class="drop-zone" data-category="end_devices"></div>
                    </div>
                    <div class="category" data-category="intermediate_devices">
                        <h4>–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</h4>
                        <div class="drop-zone" data-category="intermediate_devices"></div>
                    </div>
                    <div class="category" data-category="network_media">
                        <h4>–°–µ—Ç–µ–≤–∞—è —Å—Ä–µ–¥–∞</h4>
                        <div class="drop-zone" data-category="network_media"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
        <div class="exercise-controls">
            <button id="checkAnswers" class="check-button">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            <button id="resetExercise" class="reset-button">–°–±—Ä–æ—Å</button>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç -->
        <div id="exerciseResult" class="exercise-result"></div>
    </div>
    {% endif %}

    <div class="navigation-links">
        <a href="{% url 'chapter_detail' section.chapter.module.id section.chapter.id %}" class="back-link">‚Üê –ù–∞–∑–∞–¥ –∫ –≥–ª–∞–≤–µ</a>
    </div>
</div>

<!-- JavaScript –¥–ª—è —Ç—Ä–µ–Ω–∞–∂–µ—Ä–∞ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    // –î–∞–Ω–Ω—ã–µ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
    const exerciseData = {
        functions: [
            {
                id: 1,
                text: "–°–ª—É–∂–∏—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∫–∞–Ω–∞–ª–∞ –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∫ –∞–¥—Ä–µ—Å—É –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è.",
                correctCategory: "network_media"
            },
            {
                id: 2,
                text: "–°–ª—É–∂–∏—Ç –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –º–µ–∂–¥—É –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–π —Ü–µ–ø–æ—á–∫–æ–π –ª—é–¥–µ–π –∏ —Å–µ—Ç—å—é –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö.",
                correctCategory: "end_devices"
            },
            {
                id: 3,
                text: "–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫–∞–∫–æ–≥–æ-–ª–∏–±–æ —É–∑–ª–∞ –∫ –¥–∞–Ω–Ω–æ–π —Å–µ—Ç–∏, –∞ —Ç–∞–∫–∂–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º —Å–µ—Ç—è–º —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ–º –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω–æ–π —Å–µ—Ç–∏.",
                correctCategory: "intermediate_devices"
            }
        ],
        categories: {
            end_devices: "–û–∫–æ–Ω–µ—á–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞",
            intermediate_devices: "–ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞",
            network_media: "–°–µ—Ç–µ–≤–∞—è —Å—Ä–µ–¥–∞"
        }
    };

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
    initializeExercise();

    function initializeExercise() {
        const functionsList = document.getElementById('functionsList');
        const dropZones = document.querySelectorAll('.drop-zone');

        // –û—á–∏—â–∞–µ–º –æ–±–ª–∞—Å—Ç–∏
        functionsList.innerHTML = '';
        dropZones.forEach(zone => zone.innerHTML = '');

        // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π
        exerciseData.functions.forEach(func => {
            const functionElement = document.createElement('div');
            functionElement.className = 'function-item';
            functionElement.textContent = func.text;
            functionElement.draggable = true;
            functionElement.dataset.id = func.id;
            functionElement.dataset.correctCategory = func.correctCategory;

            functionElement.addEventListener('dragstart', handleDragStart);
            functionsList.appendChild(functionElement);
        });

        // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∑–æ–Ω—ã —Å–±—Ä–æ—Å–∞
        dropZones.forEach(zone => {
            zone.addEventListener('dragover', handleDragOver);
            zone.addEventListener('drop', handleDrop);
            zone.addEventListener('dragenter', handleDragEnter);
            zone.addEventListener('dragleave', handleDragLeave);
        });

        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        document.getElementById('exerciseResult').innerHTML = '';
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ Drag & Drop
    let draggedItem = null;

    function handleDragStart(e) {
        draggedItem = e.target;
        e.target.classList.add('dragging');
    }

    function handleDragOver(e) {
        e.preventDefault();
    }

    function handleDrop(e) {
        e.preventDefault();
        if (draggedItem && e.target.classList.contains('drop-zone')) {
            // –£–¥–∞–ª—è–µ–º –∏–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
            if (draggedItem.parentNode.classList.contains('functions-list')) {
                draggedItem.parentNode.removeChild(draggedItem);
            } else if (draggedItem.parentNode.classList.contains('drop-zone')) {
                draggedItem.parentNode.removeChild(draggedItem);
            }

            // –î–æ–±–∞–≤–ª—è–µ–º –≤ –Ω–æ–≤—É—é –∑–æ–Ω—É
            e.target.appendChild(draggedItem);
            draggedItem.classList.remove('dragging');
            draggedItem = null;

            // –£–±–∏—Ä–∞–µ–º –ø–æ–¥—Å–≤–µ—Ç–∫—É
            e.target.classList.remove('drag-over');
        }
    }

    function handleDragEnter(e) {
        if (e.target.classList.contains('drop-zone')) {
            e.target.classList.add('drag-over');
        }
    }

    function handleDragLeave(e) {
        if (e.target.classList.contains('drop-zone')) {
            e.target.classList.remove('drag-over');
        }
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤
    document.getElementById('checkAnswers').addEventListener('click', function() {
        const dropZones = document.querySelectorAll('.drop-zone');
        let correctCount = 0;
        let totalCount = exerciseData.functions.length;

        dropZones.forEach(zone => {
            const functionItems = zone.querySelectorAll('.function-item');
            functionItems.forEach(item => {
                const correctCategory = item.dataset.correctCategory;
                const currentCategory = zone.dataset.category;

                if (correctCategory === currentCategory) {
                    item.classList.add('correct');
                    item.classList.remove('incorrect');
                    correctCount++;
                } else {
                    item.classList.add('incorrect');
                    item.classList.remove('correct');
                }
            });
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
        const resultElement = document.getElementById('exerciseResult');
        const percentage = Math.round((correctCount / totalCount) * 100);

        if (correctCount === totalCount) {
            resultElement.innerHTML = `
                <div class="result-success">
                    ‚úÖ –û—Ç–ª–∏—á–Ω–æ! –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–∑–º–µ—â–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ! (${percentage}%)
                </div>
            `;
        } else {
            resultElement.innerHTML = `
                <div class="result-warning">
                    ‚ö†Ô∏è –ü—Ä–∞–≤–∏–ª—å–Ω–æ —Ä–∞–∑–º–µ—â–µ–Ω–æ ${correctCount} –∏–∑ ${totalCount} —Ñ—É–Ω–∫—Ü–∏–π (${percentage}%)
                </div>
            `;
        }
    });

    // –°–±—Ä–æ—Å —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è
    document.getElementById('resetExercise').addEventListener('click', function() {
        initializeExercise();
    });
});
</script>
{% endblock %}